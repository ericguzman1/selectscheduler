<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accenture Project Hub</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base styles and cross-browser compatibility fixes */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #f7fafc; 
            color: #1a202c;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        .non-selectable {
            -webkit-user-select: none; -moz-user-select: none; user-select: none;
        }
        /* Custom scrollbar styling for WebKit browsers */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #a3a3a3; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Custom colors matching your theme */
        .bg-\[\#424A9F\] { background-color: #424A9F; }
        .text-\[\#424A9F\] { color: #424A9F; }
        .hover\:bg-\[\#343D84\]:hover { background-color: #343D84; }
        .bg-\[\#A3E635\] { background-color: #A3E635; }
        .hover\:bg-\[\#8CD02F\]:hover { background-color: #8CD02F; }
        .border-\[\#424A9F\] { border-color: #424A9F; }
        .border-purple-500 { border-color: #9f7aea; }
        .border-red-600 { border-color: #e53e3e; }
        .border-yellow-500 { border-color: #f59e0b; }
        
        /* Kanban board styles */
        .kanban-column { min-height: 400px; max-height: 70vh; overflow-y: auto; }
        .kanban-card { cursor: grab; }
        .kanban-card:active { cursor: grabbing; opacity: 0.8; transform: scale(1.05); }
        .dragging { opacity: 0.5; }
        .drag-over { border: 2px dashed #a3e635; }

        /* Hide spinner arrows on number inputs */
        input[type='number']::-webkit-inner-spin-button, 
        input[type='number']::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type='number'] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Auth Container -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl">
            <h1 class="text-3xl font-bold text-center text-[#424A9F] mb-4">Accenture Project Hub</h1>
            <form id="login-form" class="space-y-4">
                <input type="email" id="login-email" placeholder="Email" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A3E635]">
                <input type="password" id="login-password" placeholder="Password" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A3E635]">
                <button type="submit" class="w-full bg-[#424A9F] text-white font-bold py-3 rounded-lg hover:bg-[#343D84]">Login</button>
            </form>
             <p class="text-center text-sm text-gray-500 mt-4">
                Don't have an account? <a href="#" id="show-register" class="font-semibold text-[#424A9F] hover:underline">Register here</a>
            </p>
            <form id="register-form" class="space-y-4 hidden mt-4">
                <input type="email" id="register-email" placeholder="Email" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A3E635]">
                <input type="password" id="register-password" placeholder="Password" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A3E635]">
                <button type="submit" class="w-full bg-[#A3E635] text-gray-900 font-bold py-3 rounded-lg hover:bg-[#8CD02F]">Register</button>
                 <p class="text-center text-sm text-gray-500 mt-4">
                    Already have an account? <a href="#" id="show-login" class="font-semibold text-[#424A9F] hover:underline">Login here</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Main App Container (Initially Hidden) -->
    <div id="app-container" class="min-h-screen p-4 flex-col items-center hidden">
        <div class="w-full max-w-6xl bg-white p-6 rounded-2xl shadow-xl mb-6">
            <div class="flex justify-between items-center mb-2">
                 <h1 class="text-4xl font-extrabold text-[#424A9F]">Accenture Project Hub</h1>
                 <button id="logout-btn" class="bg-gray-200 text-gray-700 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">Logout</button>
            </div>
            <p class="text-center text-gray-600 mb-4">Welcome to your team's central command center.</p>
            <div class="flex justify-center mb-4 space-x-2">
                <button data-page="schedule" class="nav-button px-4 py-2 rounded-lg font-semibold bg-[#A3E635] text-gray-900 shadow-lg">Meetings & Events</button>
                <button data-page="kanban" class="nav-button px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300">Task Board</button>
                <button data-page="issues" class="nav-button px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300">Tech Issues</button>
            </div>
        </div>
        <div id="message-area" class="w-full max-w-6xl hidden bg-blue-100 border-l-4 border-[#A3E635] text-blue-700 p-4 mb-4 rounded-lg shadow-md" role="alert">
            <p id="message-text"></p>
        </div>
        <div id="content-area" class="w-full max-w-6xl flex-grow"></div>
    </div>
    
    <div id="modal-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, collection, onSnapshot, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCBuOzD3V96thT2TIiC3n8DdvpfChGYjEo",
            authDomain: "schedule-fef69.firebaseapp.com",
            projectId: "schedule-fef69",
            storageBucket: "schedule-fef69.appspot.com",
            messagingSenderId: "565438351947",
            appId: "1:565438351947:web:b787c417351d16a19cdbce"
        };
        const GEMINI_API_KEY = "AIzaSyCBuOzD3V96thT2TIiC3n8DdvpfChGYjEo";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let userId = null;
        let currentPage = 'schedule';
        let currentEvents = [], currentTasks = [], currentIssues = [];
        let unsubscribeEvents, unsubscribeTasks, unsubscribeIssues;

        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        
        function showMessage(msg, isError = false) { /* ... same as before ... */ }
        function getIcon(name, classes = 'w-4 h-4 inline-block mr-2') { /* ... same as before ... */ }
        async function fetchGemini(prompt, isJson = false) { /* ... same as before ... */ }
        
        // --- AUTHENTICATION ---
        
        function setupAuthListeners() {
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            document.getElementById('show-register').addEventListener('click', toggleAuthForms);
            document.getElementById('show-login').addEventListener('click', toggleAuthForms);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
        }

        function toggleAuthForms(e) {
            e.preventDefault();
            document.getElementById('login-form').classList.toggle('hidden');
            document.getElementById('register-form').classList.toggle('hidden');
        }
        
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showMessage(error.message, true);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            try {
                await createUserWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showMessage(error.message, true);
            }
        }

        async function handleLogout() {
            await signOut(auth);
        }
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                appContainer.classList.add('flex'); // Make it a flex container
                setupAppListeners();
                setupDataListeners();
                handleNavigate('schedule');
            } else {
                userId = null;
                authContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
                appContainer.classList.remove('flex');
                // Detach listeners
                if (unsubscribeEvents) unsubscribeEvents();
                if (unsubscribeTasks) unsubscribeTasks();
                if (unsubscribeIssues) unsubscribeIssues();
            }
        });

        // --- APP NAVIGATION & RENDERING ---
        
        function setupAppListeners() {
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.addEventListener('click', () => handleNavigate(btn.dataset.page));
            });
        }

        function handleNavigate(pageName) {
            currentPage = pageName;
            document.querySelectorAll('.nav-button').forEach(btn => {
                const isActive = btn.dataset.page === pageName;
                btn.classList.toggle('bg-[#A3E635]', isActive);
                btn.classList.toggle('text-gray-900', isActive);
                btn.classList.toggle('shadow-lg', isActive);
                btn.classList.toggle('bg-gray-200', !isActive);
                btn.classList.toggle('text-gray-700', !isActive);
            });
            renderPage();
        }

        function renderPage() {
            const contentArea = document.getElementById('content-area');
            if (!contentArea) return;
            switch (currentPage) {
                case 'schedule': contentArea.innerHTML = renderSchedulePage(); attachScheduleListeners(); break;
                case 'kanban': contentArea.innerHTML = renderKanbanPage(); attachKanbanListeners(); break;
                case 'issues': contentArea.innerHTML = renderIssuesPage(); attachIssuesListeners(); break;
            }
        }
        
        // --- DATA LISTENERS (FIRESTORE) ---
        function setupDataListeners() {
            if (!userId) return;
            if (unsubscribeEvents) unsubscribeEvents();
            if (unsubscribeTasks) unsubscribeTasks();
            if (unsubscribeIssues) unsubscribeIssues();

            const eventsRef = collection(db, `users/${userId}/events`);
            unsubscribeEvents = onSnapshot(eventsRef, (snapshot) => {
                currentEvents = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                if (currentPage === 'schedule') renderPage();
            });

            const tasksRef = collection(db, `users/${userId}/tasks`);
            unsubscribeTasks = onSnapshot(tasksRef, (snapshot) => {
                currentTasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (currentPage === 'kanban') renderPage();
            });

            const issuesRef = collection(db, `users/${userId}/issues`);
            unsubscribeIssues = onSnapshot(issuesRef, (snapshot) => {
                currentIssues = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                if (currentPage === 'issues') renderPage();
            });
        }
        
        // --- SCHEDULE PAGE ---
        function renderSchedulePage() { /* ... same as before ... */ }
        function attachScheduleListeners() { /* ... same as before ... */ }
        async function handleEventSubmit(e) { /* ... same as before ... */ }
        async function handleAnalyzePDF() { /* ... same as before ... */ }
        async function handleGenerateEventSummary() { /* ... same as before ... */ }
        function handleExtractForServiceNow(eventId) { /* ... same as before ... */ }
        
        // --- KANBAN PAGE ---
        function renderKanbanPage() {
             return `
                <div class="bg-white p-6 rounded-2xl shadow-xl">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-center text-[#424A9F] mb-4 md:mb-0">Project Task Board</h2>
                        <button id="ai-kanban-summary-btn" class="bg-[#A3E635] text-gray-900 font-bold py-2 px-4 rounded-lg hover:bg-[#8CD02F] flex items-center justify-center">
                            ${getIcon('zap')} <span id="ai-kanban-summary-text">Generate AI Project Summary</span>
                        </button>
                    </div>
                    <form id="add-task-form" class="flex gap-2 mb-6 max-w-lg mx-auto">
                        <input type="text" name="newTaskText" placeholder="Add a new task..." required class="flex-grow p-2 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A3E635]">
                        <button type="submit" class="bg-[#424A9F] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#343D84]">${getIcon('plus')} Add</button>
                    </form>
                    <div class="grid md:grid-cols-3 gap-6">
                        ${renderKanbanColumn('todo', 'To Do')}
                        ${renderKanbanColumn('doing', 'In Progress')}
                        ${renderKanbanColumn('complete', 'Done')}
                    </div>
                </div>`;
        }
        function renderKanbanColumn(status, title) { /* ... same as before ... */ }
        function attachKanbanListeners() {
            document.getElementById('add-task-form').addEventListener('submit', handleAddTask);
            document.getElementById('ai-kanban-summary-btn').addEventListener('click', handleGenerateKanbanSummary);
            /* ... rest of the listeners are same as before ... */
        }
        async function handleGenerateKanbanSummary() {
            const btn = document.getElementById('ai-kanban-summary-btn');
            const btnText = document.getElementById('ai-kanban-summary-text');
            btn.disabled = true;
            btnText.textContent = 'Generating...';

            const todo = currentTasks.filter(t=>t.status==='todo').map(t=>t.title).join(', ') || 'None';
            const doing = currentTasks.filter(t=>t.status==='doing').map(t=>t.title).join(', ') || 'None';
            const complete = currentTasks.filter(t=>t.status==='complete').map(t=>t.title).join(', ') || 'None';
            
            const prompt = `Provide a professional project status summary. To Do tasks: ${todo}. In Progress tasks: ${doing}. Completed tasks: ${complete}.`;
            const summary = await fetchGemini(prompt);
            
            if (summary && !summary.startsWith('AI Error')) {
                 createModal("AI Project Summary", `<p class="whitespace-pre-wrap">${summary}</p>`);
            } else {
                showMessage('Failed to generate summary.', true);
            }
            btn.disabled = false;
            btnText.textContent = 'Generate AI Project Summary';
        }
        async function handleAddTask(e) { /* ... same as before ... */ }

        // --- ISSUES PAGE ---
        function renderIssuesPage() {
            return `
            <div class="bg-white p-6 rounded-2xl shadow-xl grid md:grid-cols-2 gap-8">
                <div>
                    <h2 class="text-2xl font-bold text-red-600 mb-4 flex items-center">${getIcon('xcircle')} Log New Tech Issue</h2>
                    <form id="add-issue-form" class="space-y-4">
                         <!-- ... form inputs same as before ... -->
                    </form>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-red-600 mb-4">Active Issues (${currentIssues.length})</h2>
                    <div class="space-y-3 max-h-[60vh] overflow-y-auto p-2 border rounded-xl bg-gray-50">
                        ${currentIssues.length > 0 ? currentIssues.map(issue => `
                            <div class="bg-white p-4 rounded-xl shadow-md border-l-4 ${issue.urgency === 'Urgent' ? 'border-red-600' : 'border-yellow-500'}">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-semibold">${issue.issueTitle}</h3>
                                    <div>
                                        <button data-id="${issue.id}" class="ai-diagnose-btn text-gray-400 hover:text-[#424A9F] p-1">${getIcon('zap', 'w-4 h-4 m-0')}</button>
                                        <button data-id="${issue.id}" class="delete-issue-btn text-gray-400 hover:text-red-500 p-1">${getIcon('trash', 'w-4 h-4 m-0')}</button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${issue.issueDescription}</p>
                                <span class="text-xs font-medium bg-gray-200 px-2 py-1 rounded-full mt-2 inline-block">${issue.urgency}</span>
                            </div>`).join('') : '<p class="text-center text-gray-500 p-8">No active issues.</p>'}
                    </div>
                </div>
            </div>`;
        }
        function attachIssuesListeners() {
            document.getElementById('add-issue-form').addEventListener('submit', handleAddIssue);
            document.querySelectorAll('.delete-issue-btn').forEach(btn => btn.addEventListener('click', e => handleDelete('issues', e.currentTarget.dataset.id)));
            document.querySelectorAll('.ai-diagnose-btn').forEach(btn => btn.addEventListener('click', e => handleAIDiagnosis(e.currentTarget.dataset.id)));
        }
        async function handleAIDiagnosis(issueId) {
            const issue = currentIssues.find(i => i.id === issueId);
            if (!issue) return;
            const prompt = `For a tech issue titled "${issue.issueTitle}" with description "${issue.issueDescription}", provide 3 concise, actionable troubleshooting steps a tech support person could take.`;
            const diagnosis = await fetchGemini(prompt);
            if (diagnosis && !diagnosis.startsWith('AI Error')) {
                createModal(`AI Diagnosis for: ${issue.issueTitle}`, `<p class="whitespace-pre-wrap">${diagnosis}</p>`);
            } else {
                showMessage('AI Diagnosis failed.', true);
            }
        }
        async function handleAddIssue(e) { /* ... same as before ... */ }

        // --- GENERAL CRUD & MODALS ---
        async function handleDelete(collectionName, id) { /* ... same as before ... */ }
        function createModal(title, content) {
            const modalContainer = document.getElementById('modal-container');
            modalContainer.innerHTML = `
                <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white p-6 rounded-2xl shadow-2xl max-w-lg w-full">
                        <h3 class="text-xl font-bold text-[#424A9F] mb-4">${title}</h3>
                        <div class="text-gray-700">${content}</div>
                        <div class="flex justify-end mt-4">
                            <button id="close-modal-btn" class="bg-gray-300 font-bold py-2 px-4 rounded-lg hover:bg-gray-400">Close</button>
                        </div>
                    </div>
                </div>`;
            document.getElementById('close-modal-btn').onclick = () => modalContainer.innerHTML = '';
            document.getElementById('modal-backdrop').onclick = (e) => {
                if(e.target.id === 'modal-backdrop') modalContainer.innerHTML = '';
            };
        }

        // --- APP INITIALIZATION ---
        window.onload = () => {
            setupAuthListeners();
            // onAuthStateChanged will handle the initial render
        };
    </script>
</body>
</html>

